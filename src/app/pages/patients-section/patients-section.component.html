<div class="min-h-screen bg-gradient-to-b from-blue-50 to-white px-4 py-20">
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
  </div>
  <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 shadow-2xl border border-white/20">
      <h1 class="text-4xl md:text-5xl font-bold text-center text-gray-700 mb-2">Mis Turnos</h1>
      <p class="text-center text-gray-600 text-lg">Gestiona tus turnos médicos</p>
  </div>
  <div *ngIf="!isLoading && patients.length > 0" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 md:pt-12 pt-8">
    <div *ngFor="let patient of patients"
        tabindex="0"
        (click)="selectPatient(patient)"
        class="bg-white rounded-lg shadow hover:shadow-lg cursor-pointer p-4 transition-all group focus:ring-2 focus:ring-blue-400 outline-none">

      <div class="w-20 h-20 mx-auto aspect-square mb-3 rounded-full overflow-hidden border-2 border-blue-100 group-hover:scale-105 transition-transform">
        <img [src]="patient.profile_image_url || '/default-profile.png'" alt="Foto paciente"
            class="w-full h-full object-cover" />
      </div>

      <div class="text-center">
        <p class="text-gray-800 font-semibold text-sm truncate">
          {{ patient.first_name }} {{ patient.last_name }}
        </p>
        <p class="text-gray-500 text-xs">DNI: {{ patient.dni }}</p>
        <p class="text-gray-500 text-xs">Edad: {{ patient.age }} años</p>
      </div>
    </div>
  </div>
  
  <div *ngIf="!isLoading && patients.length === 0" class="text-center text-gray-500 text-sm">
    No se encontraron pacientes atendidos.
  </div>

  <app-modal-view
  *ngIf="showPatientModal"
  [title]="'Historial de Turnos de ' + selectedPatient?.first_name"
  [description]="'Estos son los turnos realizados con este paciente.'"
  [showCancelButton]="true"
  (close)="showPatientModal = false">
  
  <ng-container *ngIf="patientAppointments.length > 0; else noAppointments">
    <ul class="space-y-4 mt-4">
      <li *ngFor="let appt of patientAppointments" class="p-3 bg-white rounded shadow">
        <p><strong>Fecha:</strong> {{ appt.appointment_date | date: 'fullDate' }}</p>
        <p><strong>Especialidad:</strong> {{ appt.specialty }}</p>
        <p *ngIf="appt.review"><strong>Reseña:</strong> {{ appt.review }}</p>
        <p *ngIf="appt.rating"><strong>Calificación:</strong> {{ appt.rating }}/5</p>
      </li>
    </ul>
  </ng-container>

  <ng-template #noAppointments>
    <p class="text-sm text-gray-600 mt-4">Este paciente no tiene turnos realizados contigo.</p>
  </ng-template>
</app-modal-view>
</div>
